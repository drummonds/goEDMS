<!DOCTYPE html>
<html>
<head>
    <title>Test Filtering Logic</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f0f0f0; padding: 10px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Testing HomePage Filtering Logic</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        fetch('http://localhost:8000/documents/filesystem')
            .then(r => r.json())
            .then(data => {
                // Simulate checkData function
                output.innerHTML += '<div class="result"><h2>Step 1: Received Data</h2>';
                output.innerHTML += '<pre>fileSystem length: ' + data.fileSystem.length + '</pre>';
                output.innerHTML += '<pre>' + JSON.stringify(data.fileSystem, null, 2) + '</pre></div>';

                // Check if data.fileSystem[0] is null (line 104)
                output.innerHTML += '<div class="result"><h2>Step 2: Check if fileSystem[0] is null</h2>';
                if (data.fileSystem[0] == null) {
                    output.innerHTML += '<pre style="color: red;">ERROR: data.fileSystem[0] is null - would return early!</pre>';
                    return;
                } else {
                    output.innerHTML += '<pre style="color: green;">OK: data.fileSystem[0] exists</pre>';
                }
                output.innerHTML += '</div>';

                // Simulate getFiles function
                const folder = data.fileSystem[0];
                const files = data.fileSystem;

                output.innerHTML += '<div class="result"><h2>Step 3: Calling getFiles</h2>';
                output.innerHTML += '<pre>folder.id: "' + folder.id + '"</pre>';
                output.innerHTML += '<pre>folder.name: "' + folder.name + '"</pre>';
                output.innerHTML += '<pre>files.length: ' + files.length + '</pre>';
                output.innerHTML += '</div>';

                // Filter logic (lines 127-131)
                output.innerHTML += '<div class="result"><h2>Step 4: Filtering Files</h2>';
                output.innerHTML += '<table border="1" style="border-collapse: collapse; width: 100%;">';
                output.innerHTML += '<tr><th>Index</th><th>Name</th><th>ParentID</th><th>Folder ID</th><th>Match?</th><th>Returned?</th></tr>';

                const fileResults = files.filter(function(file, index) {
                    const matches = file.parentID == folder.id;
                    const returnValue = matches ? file : undefined;

                    output.innerHTML += '<tr>';
                    output.innerHTML += '<td>' + index + '</td>';
                    output.innerHTML += '<td>' + file.name + '</td>';
                    output.innerHTML += '<td>"' + file.parentID + '"</td>';
                    output.innerHTML += '<td>"' + folder.id + '"</td>';
                    output.innerHTML += '<td style="background: ' + (matches ? '#90EE90' : '#FFB6C1') + '">' + matches + '</td>';
                    output.innerHTML += '<td>' + (returnValue !== undefined ? 'YES' : 'NO') + '</td>';
                    output.innerHTML += '</tr>';

                    if (file.parentID == folder.id) {
                        return file;
                    }
                });

                output.innerHTML += '</table></div>';

                output.innerHTML += '<div class="result"><h2>Step 5: Filter Results</h2>';
                output.innerHTML += '<pre>fileResults.length: ' + fileResults.length + '</pre>';
                if (fileResults.length === 0) {
                    output.innerHTML += '<pre style="color: red; font-size: 20px;">PROBLEM: Zero files after filter! This would show "Nothing to show"</pre>';
                } else {
                    output.innerHTML += '<pre style="color: green;">Files found:</pre>';
                    output.innerHTML += '<pre>' + JSON.stringify(fileResults.map(f => ({name: f.name, id: f.id})), null, 2) + '</pre>';
                }
                output.innerHTML += '</div>';

                // Check for React state setting
                output.innerHTML += '<div class="result"><h2>Step 6: What Would Be Displayed</h2>';
                output.innerHTML += '<pre>setCurrentFileSystem would be called with ' + fileResults.length + ' files</pre>';
                output.innerHTML += '<pre>FileBrowser would receive files=' + JSON.stringify(fileResults.map(f => f.name)) + '</pre>';
                output.innerHTML += '</div>';
            })
            .catch(err => {
                output.innerHTML += '<div class="result" style="color: red;"><h2>ERROR</h2><pre>' + err + '</pre></div>';
            });
    </script>
</body>
</html>
